<div class="product-gallery">
  {%- assign current_variant = product.selected_or_first_available_variant -%}
  {%- assign featured_image = current_variant.featured_image | default: product.featured_image -%}

  {% for image in product.images %}
    {% capture wrapper_class %}product-gallery__wrap{%- unless featured_image == image -%} hide{%- endunless -%}{% endcapture %}

    {% include 'responsive-image' with
      image: image,
      max_width: 700,
      max_height: 800,
      image_attributes: "data-product-featured-image",
      wrapper_class: wrapper_class,
      wrapper_attributes: "data-product-image-wrapper",
      image_class: "product-gallery__image",
    %}
  {% endfor %}

  {% if product.images.size > 1 %}
    <ul class="product-gallery__thumbnails">
      {% for image in product.images %}
        <li class="product-gallery__item">
          <a href="{{ image.src | img_url: '480x480' }}" class="product-gallery__thumbnail-link" data-thumbnail-id="{{ image.id }}" data-product-single-thumbnail>
            <img class="product-gallery__thumbnail" src="{{ image.src | img_url: '160x160' }}" alt="{{ image.alt | escape }}">
          </a>
        </li>
      {% endfor %}
    </ul>
  {% endif %}
</div>